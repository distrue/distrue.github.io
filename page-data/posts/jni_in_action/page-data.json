{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/jni_in_action","result":{"data":{"markdownRemark":{"id":"5a39c16f-ffa1-5468-8d41-77f516030076","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 946px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66256a7277dbea8793d6f64081ced4ee/36c33/jni%2B1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAABrklEQVQ4y6VTTU/CQBAl/gn/hjcTD/4zExPPeDTxYox8XEyMRgkWFfUCRI2IhIQKZVtohVL5LILQLk92ixW0MUYnmezO7Mzre7tTH2ZsPB67q+PTPctRez43Uztrvp8BKY9pg8BW09Mz+h9Ah11VKUAnOQxtzvXvgMwsmyKjdpF97mL0H0DbtsEEW6aBl7tD1B8EjDo6Z8zOfgXoVQDaB7R7oEMm6K8/134FpNR5BFmW4ff7EQoGETs7R06UEN4/QPzqGoFAANFoFJqmeTP0ujdWHIvFkEgkuMukhPjFBVKpFCKRCARBQK1W+9bH1jnAD4blchmmaaJYLEJVVeTzeb4Xn54gSRIIIfzc6WMzSl1QnxdtwzDQarWgV6vQKhX+AeakWEJNe4ZSImg2mw7g5IFm79RHp2B1w8RbbzAHLCoV5CTixqSn4/jmGnU4j8P00E4DlpjGuP0yf4frW0E87oXc5t2jEywsrWBje8fNrZ0eY3F1GedSgceMm5U8xTC8yceJ6eeSR5PhvZRuUSpkgKl6UVaQzGTxOvhkTVo9hLMPqJh9RyJzsz35NXVX8jvUCuAC8cPVEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/66256a7277dbea8793d6f64081ced4ee/8ac56/jni%2B1.webp 240w,\n/static/66256a7277dbea8793d6f64081ced4ee/d3be9/jni%2B1.webp 480w,\n/static/66256a7277dbea8793d6f64081ced4ee/30833/jni%2B1.webp 946w\"\n          sizes=\"(max-width: 946px) 100vw, 946px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/66256a7277dbea8793d6f64081ced4ee/8ff5a/jni%2B1.png 240w,\n/static/66256a7277dbea8793d6f64081ced4ee/e85cb/jni%2B1.png 480w,\n/static/66256a7277dbea8793d6f64081ced4ee/36c33/jni%2B1.png 946w\"\n          sizes=\"(max-width: 946px) 100vw, 946px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/66256a7277dbea8793d6f64081ced4ee/36c33/jni%2B1.png\"\n          alt=\"img\"\n          title=\"img\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>JNI (Java Native Interface)를 통해 Java runtime 위에서 C++ extension을 실행했다.</p>\n<h3 id=\"motivation\" style=\"position:relative;\"><a href=\"#motivation\" aria-label=\"motivation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Motivation</h3>\n<p>기존의 Java runtime에 만족하지 못하고 C++ extension을 붙인 이유는 다음과 같다.</p>\n<ol>\n<li>Java POJO는 무겁다\nJava의 <code class=\"language-text\">Map</code>과 같은 원시 타입이 아닌 Object들의 POJO는 기본적으로 internal에서 차지하는 memory 양이 꽤 된다. 기본적인 Map도 110byte를 넘는 수준이다. Memory 압박이 없는 경우는 상관이 없지만, memory를 최대 효율로 사용하려는 경우에는 생각보다 많은 손해를 보게 된다. Java의 편한 interface에서의 코딩을 포기하고 C++ extension을 사용해 조금 더 메모리를 절약해보는 시도를 해보기로 했다.</li>\n<li>\n<p>Java Memory 절약을 위해 사용되는 방법들의 속도 저하\n물론 1. 의 결정을 내리기 전에 Java 안에서 문제 해결을 시도해 봐야 할 것이다. 아래와 같은 방법들을 시도해 볼 수 있다.</p>\n<ul>\n<li>Java Serialization: Java 안의 직렬화 interface <code class=\"language-text\">Serializable</code>을 implement 하는 class를 만들고, 이를 <code class=\"language-text\">byte[]</code> 로 바꿔 저장할 수 있다. 그러나 이는 Java POJO에 들어있는 메타데이터들도 모두 그대로 바꾸는 것이기 때문에 memory 절약에서 큰 효과를 거둘 수 없다.</li>\n<li>3rd-party library 사용: google의 <a href=\"https://google.github.io/flatbuffers/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">flatBuffer</a> 와 같이 별도의 직렬화 스펙을 활용해 데이터를 <code class=\"language-text\">byte[]</code> 로 저장할 수 있다.</li>\n</ul>\n<p>후자의 방법은 생각보다 높은 performance를 얻를 수 있는데, 여기에도 한계점은 존재한다. 데이터를 <code class=\"language-text\">byte[]</code> 로 직렬화해 사용하기 때문에 <code class=\"language-text\">write</code>, <code class=\"language-text\">read</code> 할 때마다 ser/deserialize 를 수행해야 한다는 점이다. 이 부분은 생각보다 큰 overhead로 작용하게 된다.</p>\n</li>\n</ol>\n<p> 위의 2가지 문제를 해결하기 위해서는 1> Java POJO와 같이 메타 데이터는 저장하지 않으면서, 2> 빠른 access를 위해 직렬화가 아닌 구조화된 형식으로 데이터를 저장하고 있어야 한다는 점이다. 이를 해결하기 위해 JNI을 선택하게 되었다.</p>\n<h3 id=\"objective\" style=\"position:relative;\"><a href=\"#objective\" aria-label=\"objective permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Objective</h3>\n<p>JNI를 통한 방법이 기존의 방법보다 높은 효율을 달성하기 위해서는 다음을 만족해야 한다.</p>\n<ol>\n<li>높은 메모리 효율</li>\n<li>빠른 Data Access</li>\n</ol>\n<p>이를 만족하는지 POC 하는 과정을 이후 기록해둘 것이다.</p>\n<h3 id=\"1-jni-project-setting\" style=\"position:relative;\"><a href=\"#1-jni-project-setting\" aria-label=\"1 jni project setting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. JNI Project Setting</h3>\n<blockquote>\n<p><i>여튼 그래서 이 포스트의 시작은 여기부터…</i></p>\n</blockquote>\n<p>Gradle, cmake를 활용해 C++ extension을 빌드하고 실행해볼 수 있도록 했다.\n구체적인 방식은 Gradle 위에서 shell script를 실행하는 방식으로 구성했다.</p>\n<p><a href=\"https://github.com/distrue/JNI-in-action\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><img src=\"https://opengraph.githubassets.com/2ae3dcf1fa2b05a8108b19d782c9bd3809444b5c22b84e725560f17f2d3add80/distrue/JNI-in-action\" alt=\"img\"></a></p>\n<p>우선은 깃헙 링크에서,,, 글로 자세한 내용도 update 예정 😎</p>","fields":{"slug":"/posts/jni_in_action","tagSlugs":["/tag/java/","/tag/c/","/tag/gradle/","/tag/cmake/"]},"frontmatter":{"date":"2021-07-18T00:00:00.000Z","description":"JNI를 활용해 java runtime 위에 c++ extension을 연결하기","tags":["Java","c++","gradle","cmake"],"title":"JNI in Action (Java ↔️ c++)","socialImage":{"publicURL":"/static/66256a7277dbea8793d6f64081ced4ee/jni+1.png"}}}},"pageContext":{"slug":"/posts/jni_in_action"}},"staticQueryHashes":["251939775","401334301","825871152"]}