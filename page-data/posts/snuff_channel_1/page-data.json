{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/snuff_channel_1","result":{"data":{"markdownRemark":{"id":"ddf4749d-ebbf-5a1f-a25b-f8eaf2c0e092","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 898px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/04e8d92ccca812e3e1f193639ef09065/84cc5/210316.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoUlEQVQ4y41S+0+SYRjlb6pWS03KvGWWWq6ylmvr8kNNV9mWWk5zgeYNUExylro5SZTUMHIZCPFD4g2SRUIZBqLj9ikCKiCcvu9FnW5ZPdvZ++x7np3nnLOPFY1GsV/tnm33ka131beORccylpwre3ZYTBMMBhEOhwmcTic8Hg9CoRBZYBCJRHbA1OzcEtrEGsx+X8TQiB49somdGcvn80GtVkMmk0EqlYLP50MkEsFisfxRNaOsq38Mk7qfUGtmMa2bx/tRAz5pTTFCr9dLCLVaLYxGI6xWK0wmE3Q6HVwuFyiKgsFgILNoJAyzxYHeoQk4HF4s2Cn8sroxpbegTz4VI3S53Ojs7IREIkF3dzeGh4fJAS6XCx6PB71eDw6Hg5KSUizaF0B519HapcL4xBzEknF8VBohHZqEfHQmRrjbjj8QQCCwRucRpZUt02ptpA/Q3+12OzY2gmRPPWaC8JUCI6qvGJBPo7lDCc+KP0Zo/uGAw7mKtfUQ/qc2t8KfnJmHZtwM1WcT3JQv9gfQMxY7rR6Zuc3Iu/YStwq6UFoxAEGzkthRjH7DF4MNlnkX3B4fNjcj/zzIOpZSh7ikGhxhP8OhhCocjOcSHGAQx8XhxGokZfCQdaEF+TfaUVD0GpVV79DSpkbvmymoNGboZ2ywLVDw+zfASkytB5sBrfR4esMesNMakJ7dhIwcIZJP88lRBkdPMAKqkXpWgJRMAc5ffoHsiy3IvdIaI9wP8SdrcfV6O+7cE+P2XTHKn8pQWj6Ax08GUVzWj1reB5RVvgWnRo5zeSLicF9CJortnlF7v7gPjyoG8ZAmKnzQA75QgcKiHjpvBRqfK5F/s4NE91fCbSQk1+EUbT31jABpWY1Iz2oiFpNpu8ybc0lErDN7vwHT0iclePfqIwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/04e8d92ccca812e3e1f193639ef09065/8ac56/210316.webp 240w,\n/static/04e8d92ccca812e3e1f193639ef09065/d3be9/210316.webp 480w,\n/static/04e8d92ccca812e3e1f193639ef09065/005c4/210316.webp 898w\"\n          sizes=\"(max-width: 898px) 100vw, 898px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/04e8d92ccca812e3e1f193639ef09065/8ff5a/210316.png 240w,\n/static/04e8d92ccca812e3e1f193639ef09065/e85cb/210316.png 480w,\n/static/04e8d92ccca812e3e1f193639ef09065/84cc5/210316.png 898w\"\n          sizes=\"(max-width: 898px) 100vw, 898px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/04e8d92ccca812e3e1f193639ef09065/84cc5/210316.png\"\n          alt=\"img\"\n          title=\"img\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>서울대학교 주변의 맛집을 소개하는 인스타그램 인플루언서 스누푸파의 콘텐츠를 카카오톡 채널로 만들고 싶다는 문의를 받아\n카카오톡 채널을 개설하였다. 먼저 1) 인스타그램에 있는 모든 게시물들을 긁어오고, 2) 긁어온 데이터로 카카오톡 채널에서\n이미지 / 주소 / 링크를 제공해주는 방식으로 구성하였다.</p>\n<p>Puppeteer는 google chrome을 control 할수 있는 nodeJS 기반의 라이브러리다.\n기존에는 crawling을 위해 Selenium을 많이 활용하는데, Puppeteer는 selenium 보다 직관적인 문법과\n중간 driver를 거치지 않아 빠른 동작이 가능한 장점이 있다. (<a href=\"https://github.com/puppeteer/puppeteer\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">puppeteer link</a>)</p>\n<p>puppeteer를 통해 <a href=\"https://instagram.com/snu_foodfighter\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">스누푸파</a>의 페이지를 크롤링해 각 리뷰와 사진을 추출할 수 있도록 하였다.</p>\n<p><a href=\"https://github.com/distrue/snuff_macro\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">github link</a></p>\n<p>크롤링을 해오면서 다음과 같은 어려움을 겪었었다.</p>\n<h3 id=\"1-http-429-too-much-requests\" style=\"position:relative;\"><a href=\"#1-http-429-too-much-requests\" aria-label=\"1 http 429 too much requests permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. HTTP 429 (Too much requests)</h3>\n<ul>\n<li>Instagram 에서는 특정 유저가 반복적인 이미지를 로드하는 행동을 반복하는 경우 봇이나 악의적 유저로 판단하고 page의 content를 로드하지 못하도록 이미지 / 콘텐츠 요청에 대해 <code class=\"language-text\">429</code> response를 반환한다. </li>\n<li>\n<p>실제로 봇을 디버깅하며 반복적인 이미지 요청으로 간주하는 case를 몇가지 짚어보자면 다음과 같다.</p>\n<ul>\n<li>로그인 시 <code class=\"language-text\">잠시 후에 다시 시도해주세요</code>: 로그인을 반복적으로 많이 시도했을 때 발생한다. 이 경우 계정 단위로 잠기기 때문에 계정을 교체해주면 된다. 실제로 개발하면서 3개의 계정을 바꿔가며 사용했다. 하나의 계정이 잠기면 보통 12시간 / 24시간 정도 계정이 잠기게 된다. </li>\n<li>page content 로드 시 <code class=\"language-text\">429 Too Much Requests</code>: 이미지를 일정 시간보다 빠르게, 반복적으로 요청하는 경우 (2초 이내 정도로 추정)에도 봇으로 간주되게 된다. 한 가지 확인한 점은 이 429 기준도 ID 정보 값을 기준으로 한다는 것이다. (IP 단위 차단은 아직은 받아 본적이 없다, 반복적으로 계정이 정지되면 IP도 차단될 수도…?)</li>\n<li>디버깅 단계가 아니면 계정의 로그인 정지는 크게 걱정할 필요는 없을 듯 하고, 이미지 로드에 대한 시간의 경우 강제로 이미지를 보고 기다리는 시간을 지정시켰다. (code에서 포스트 로드 후 2초씩 대기하도록 지정함)</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-댓글에서-태그-가져오기\" style=\"position:relative;\"><a href=\"#2-%EB%8C%93%EA%B8%80%EC%97%90%EC%84%9C-%ED%83%9C%EA%B7%B8-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"2 댓글에서 태그 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 댓글에서 태그 가져오기</h3>\n<ul>\n<li>\n<p>스누푸파는 게시물에 대한 태그를 본문이 아닌 댓글에 숨겨 두었다. 크게 2가지 case로 나뉘게 된다.</p>\n<ul>\n<li>댓글에 바로 써두는 경우</li>\n<li>댓글에는 아이콘 하나만 배치하고, 댓글의 답글에 태그를 적는 경우</li>\n</ul>\n</li>\n<li>두가지 경우에 대해 대응할 수 있도록 최상위 댓글까지 접근한 후, <code class=\"language-text\">snu_foodfighter</code> 이름을 가진 댓글의 답글을 확인해 긁어 오도록 했다. </li>\n<li>단, 이벤트 게시물의 경우 댓글이 너무 많이 써있는 경우가 있는데, 이 경우들은 댓글 로드가 150개 이상인 경우 이벤트 게시물로 간주하고 넘어가도록 설정하였다.</li>\n</ul>","fields":{"slug":"/posts/snuff_channel_1","tagSlugs":["/tag/chatbot/","/tag/kakao-channel/"]},"frontmatter":{"date":"2021-03-16T22:00:37.121Z","description":"스누푸파 카카오 채널 리뉴얼! puppeteer를 이용해 인스타그램을 크롤링 했습니다","tags":["chatbot","kakao channel"],"title":"스누푸파 카카오채널 (1) Puppeteer로 인스타 크롤링하기","socialImage":{"publicURL":"/static/04e8d92ccca812e3e1f193639ef09065/210316.png"}}}},"pageContext":{"slug":"/posts/snuff_channel_1"}},"staticQueryHashes":["251939775","401334301","825871152"]}